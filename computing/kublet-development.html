<!DOCTYPE html>
<html lang="en-GB"><meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" /><!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Kublet Development" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="My adventures in developing for the kublet arduino device" />
<meta property="og:description" content="My adventures in developing for the kublet arduino device" />
<link rel="canonical" href="https://willpower232.github.io/computing/kublet-development.html" />
<meta property="og:url" content="https://willpower232.github.io/computing/kublet-development.html" />
<meta property="og:site_name" content="Blogumentation willpower232" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-10-18T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Kublet Development" />
<script type="application/ld+json">
{"description":"My adventures in developing for the kublet arduino device","url":"https://willpower232.github.io/computing/kublet-development.html","@type":"BlogPosting","headline":"Kublet Development","dateModified":"2024-10-18T00:00:00+00:00","datePublished":"2024-10-18T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://willpower232.github.io/computing/kublet-development.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<title>
	
		Kublet Development
	
</title>


	<meta itemprop="description" name="description" content="My adventures in developing for the kublet arduino device" />


<meta property="og:locale" content="en_GB" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Kublet Development" />
<meta property="og:site_name" content="Blogumentation | willpower232" />

	<meta property="og:description" content="My adventures in developing for the kublet arduino device" />


<meta name="twitter:title" content="Kublet Development" />

	<meta name="twitter:description" content="My adventures in developing for the kublet arduino device" />

<meta name="twitter:site" content="@willpower232" />
<meta name="twitter:card" content="summary" />

<meta name="fediverse:creator" content="@willpower232@php.social" />

<link rel="stylesheet" href="/assets/main.css" />

<link rel="icon" href="/favicon.png" />

<meta name="pinterest" content="nopin" />
<body><header>
	<hgroup>
		<h2>Blogumentation</h2>
		<p>helping future me remember cool things</p>
	</hgroup>
	<nav>
		<menu>
			<li><a href="/">Home</a></li>
			<!-- <li><a href="#">Projects</a></li> -->
		</menu>
	</nav>
</header>

    

    

    
        <nav>
            <h3>Tags in computing</h3>
            <menu>
                
                    <li><a href="/aws/">aws</a></li>
                
                    <li><a href="/gaming/">gaming</a></li>
                
                    <li><a href="/linux/">linux</a></li>
                
                    <li><a href="/server-config/">server-config</a></li>
                
                    <li><a href="/software-choices/">software-choices</a></li>
                
            </menu>
        </nav>
    

    <main>
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 itemprop="name headline">Kublet Development</h1>
	<p class="post-meta"><time datetime="2024-10-18T00:00:00+00:00" itemprop="datePublished">
			2024-10-18
		</time></p>

	<div class="post-content" itemprop="articleBody">
		<p><em>this post is referring to the kublet arduino device available from <a href="https://thekublet.com" target="_blank" rel="noopener noreferrer">thekublet.com</a>, if you’re here for kubernetes because search engines have taken a dive in quality, I can only apologise</em></p>

<p><img src="/assets/img/20241018_100332.JPG" alt="My kublet at home"></p>

<h2 id="setting-up">Setting Up</h2>

<p>I hasten to add that I have never worked with c++ (aka cpp) or arduino development before so if I get anything wrong, bear with me. Also the information available at <a href="https://developers.thekublet.com" target="_blank" rel="noopener noreferrer">developers.thekublet.com</a> does have a few gaps.</p>

<p>I am already a Visual Studio Code (or VSCodium) person and I work exclusively on Linux computers so if you’re not using either of those, I’m sorry for you.</p>

<p>I needed to <code class="language-plaintext highlighter-rouge">sudo apt install python3-venv</code> in order for PlatformIO to work so do that first.</p>

<p>I grabbed the <a href="https://platformio.org" target="_blank" rel="noopener noreferrer">PlatformIO</a> extension for Code but apparently you can install the CLI directly but I don’t know what that means beyond you probably have to manage your own dependency installations.</p>

<p>Finally you need the krate binary from the kublet maker, I got mine from <a href="https://github.com/kublet/krate" target="_blank" rel="noopener noreferrer">Github</a>, as well as the kublet mobile app for your phone.</p>

<p>You almost definitely need a different micro USB cable in order to get the serial output but only time will tell. If you do want this then you probably also need to plug directly into your computer rather than through a USB hub which can still power the device, just not route the serial connection properly at least in my case.</p>

<p>One other pain point, when connecting the kublet to the computer and trying to run <code class="language-plaintext highlighter-rouge">krate monitor</code> I got permission errors. Now that it was connected I was able to <code class="language-plaintext highlighter-rouge">ls -hal /dev/ttyUSB0</code> and see that the <code class="language-plaintext highlighter-rouge">dialout</code> group has access to it so I needed to <code class="language-plaintext highlighter-rouge">sudo usermod -aG dialout wh</code> and reboot in order to see the serial output.</p>

<h2 id="getting-started">Getting Started</h2>

<p>I set up the working directory and a git repo as I normally do at the start of a new project. I then needed to <code class="language-plaintext highlighter-rouge">krate init</code> to get everything happening. You can also reference <a href="https://github.com/kublet/community/tree/main/apps/bored" target="_blank" rel="noopener noreferrer">their community GitHub</a> to see what structure you should end up with, I liked how the PlatformIO extension automatically installs any changes to the platformio.ini file which is handy.</p>

<p>You can also look at the contents of <code class="language-plaintext highlighter-rouge">main.cpp</code> to get started (mostly because I’d never seen c++ code before). I wanted my screen to reference a remote API so this bored project was also pretty close.</p>

<p>As a couple of major roadblocks, ArduinoJSON.h should be ArduinoJson.h as it is case sensitive and I had to copy HTTPClient.h and HTTPClient.cpp into the src directory in order to use a custom header making a request to my API.</p>

<h2 id="development">Development</h2>

<p>As a scripting language, it works top to bottom so I added a function between setup and loop which drew to the screen so that loop could send through testing data and I could see what the screen looks like completely filled. Unfortunately, I wanted to set three separate variables to 888 but that caused some kind of memory issue and crashed the device.</p>

<p>The <code class="language-plaintext highlighter-rouge">ui.drawText</code> method specifically requires a <code class="language-plaintext highlighter-rouge">const char*</code> (probably also called a reference) so I had to change the type of some data from my REST API which is a little annoying. Apparently this uses C++11 so I was able to do the following:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">JsonObject</span> <span class="n">stats_hpa</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">"hpa"</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">hpaMinInt</span> <span class="o">=</span> <span class="n">stats_hpa</span><span class="p">[</span><span class="s">"min"</span><span class="p">];</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">hpaMinTemp</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">hpaMinInt</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">hpaMin</span> <span class="o">=</span> <span class="n">hpaMinTemp</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
</code></pre></div></div>

<p>Even though the sprite looks like it is 240 by 150, you can actually address the entire 240x240 screen. I did choose to <code class="language-plaintext highlighter-rouge">ui.clear()</code> before writing to the screen a second time, I tried to just overwrite some parts but it didn’t really work so mostly you just have to remember to draw things top to bottom, left to right, and you should have a good time.</p>

<h3 id="todo">Todo</h3>

<p>I briefly considered <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/network/esp_now.html" target="_blank" rel="noopener noreferrer">ESP-NOW</a> as hinted by the developer docs since I have three kublets but it was easier to just develop one application and deploy it three times.</p>

<p>On the standard apps you can press the button on the back to access a menu but that didn’t seem possible with my output so I can only presume the documentation is missing something.</p>

<h2 id="deployment">Deployment</h2>

<p>When you think you’re ready to try something, you can use <code class="language-plaintext highlighter-rouge">krate build</code> to confirm it builds. I’m not sure if it is necessary before each <code class="language-plaintext highlighter-rouge">krate send &lt;ip&gt;</code> but it does offer piece of mind.</p>

<p>Also when you want to reset the device, plug it in whilst holding the button on the back, this will eventually flash the screen white and you’ll see the “Open mobile app” message. <strong>Make sure not to apply pressure to the screen whilst you do this</strong></p>

<p>I found that the mobile app (1.0.5 on Android anyway) needed to have the storage reset in order to allow me to change the name of a second kublet but then I was reflashing it repeatedly during this process anyway so I only named it on the final run. The mobile app is the only way to apply the WiFi details (2.4Ghz only btw) so a little annoying. Flashing the Developer app to the device will take a few minutes but the screen on the device (and the serial output) will tell you which IP address you can <code class="language-plaintext highlighter-rouge">krate send &lt;ip&gt;</code> to.</p>

<p>I had some problems so I ended up resetting the device all the time but once you know the IP address of the device, you should be able to <code class="language-plaintext highlighter-rouge">krate send &lt;ip&gt;</code> to it repeatedly until you’re happy.</p>

	</div>
</article>

    </main><footer>
	© William Hall<br>
	<a href="mailto:will@willpoweredinc.net">will@willpoweredinc.net</a>
</footer>

<aside>
	<div>
		<a href="https://willpower232.com" target="_blank" rel="noopener noreferrer">
			<svg><use xlink:href="/assets/template/footlink.svg#icon-face"></use></svg>
		</a>
	</div>
</aside>
</body>

<script src="/assets/template/fixremotesvgs.js"></script>
<script src="/assets/template/shareorcopy.js"></script>

<!--
needless to say, the reverse dutch classic
overarm was now out of the question
-->
